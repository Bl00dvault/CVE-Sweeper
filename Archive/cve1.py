# This is designed to be a Nessus to Snort Rule generator based on the "CVE Reference" column in Nessus .csv's
import csv, datetime, os, glob
path = raw_input("Enter the filepath to where your Nessus CSV's are stored: ")
outfile=open("msn_snort_rules.txt","w")
outfile.close()
x = 0
while x < len(glob.glob(os.path.join(path,'*.csv'))):
	for filename in glob.glob(os.path.join(path,'*.csv')):
		cve_row = []

		with open(filename) as csvfile:
			reader = csv.DictReader(csvfile)
			for row in reader:
				if row['CVE'] != '':
					cve_row.append(row['CVE'][4:])
		rules = open('community.rules', 'r')
		reader = rules.read().split('#')
		outfile=open("msn_snort_rules.txt","a")
		outfile.write("--------------------Rules generated on " + filename + " at " + str(datetime.datetime.now())[:16] + "--------------------")
		i = 0
		for s in reader:
			reader = rules.read().splitlines()
			for item in cve_row:
				if item in s:
					outfile.write("\n")
					outfile.write(s[1:])
					i +=1
		outfile.write("\n")
		outfile.write("--------------------This script generated " + str(i) + " Snort rules based on mission data!--------------------")
		outfile.write("\n")
		outfile.write("\n")			
		outfile.close()
	x += 1
